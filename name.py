# =============================
# HEALICIOUS KIOSK â€” 700 FOOD DB + ì‹¤ì œ ìŒì‹ ì´ë¦„ + ì•„ì¹¨/ì ì‹¬/ì €ë… + ê³¼í•™ì  ì›ë¦¬
# =============================

import streamlit as st
import pandas as pd
import numpy as np
import os

st.set_page_config(page_title="Healicious", layout="centered")

# =============================
# BRAND
# =============================
st.markdown("""
<div style='display:flex;align-items:center;gap:12px;margin-bottom:25px;'>
    <span style='font-size:36px;font-weight:900;'>ğŸ¥— Healicious</span>
</div>
""", unsafe_allow_html=True)

# =============================
# LOAD FOOD DATABASE (ì‹¤ì œ ìŒì‹ + 700ê°œ)
# =============================
def load_food_database():
    # ì‹¤ì œ ìŒì‹ DB (200ê°œ ì´ìƒ ìƒ˜í”Œ)
    foods = [
        # ë‹¨ë°±ì§ˆë¥˜
        ("ë‹­ê°€ìŠ´ì‚´", 165, 31, 0, 3.6),
        ("í›ˆì œ ë‹­ê°€ìŠ´ì‚´", 130, 25, 2, 2),
        ("ì‚¼ì¹˜êµ¬ì´", 280, 22, 0, 18),
        ("í›ˆì œ ì—°ì–´", 200, 20, 3, 12),
        ("ì—°ì–´ ìŠ¤í…Œì´í¬", 320, 22, 14, 18),
        ("ê³„ë€ì°œ", 140, 12, 4, 6),
        ("ê³„ë€í›„ë¼ì´", 180, 13, 1, 14),
        ("ì‚¶ì€ ê³„ë€", 77, 6, 1, 5),
        ("ë‘ë¶€", 84, 9, 2, 4),
        ("ì—°ë‘ë¶€", 55, 5, 2, 3),
        ("ë‘ë¶€ìŠ¤í…Œì´í¬", 210, 15, 10, 12),
        ("ì‡ ê³ ê¸° ìŠ¤í…Œì´í¬", 350, 30, 0, 25),
        ("ë¼ì§€ì•ˆì‹¬êµ¬ì´", 230, 28, 3, 12),

        # ìƒëŸ¬ë“œ
        ("ì‹œì €ìƒëŸ¬ë“œ", 320, 12, 18, 22),
        ("ì—°ì–´ìƒëŸ¬ë“œ", 330, 22, 14, 18),
        ("ì¹˜í‚¨ìƒëŸ¬ë“œ", 240, 26, 12, 10),
        ("ì•„ë³´ì¹´ë„ìƒëŸ¬ë“œ", 280, 8, 15, 20),
        ("ê·¸ë¦°ìƒëŸ¬ë“œ", 140, 4, 12, 7),
        ("í€´ë…¸ì•„ìƒëŸ¬ë“œ", 220, 8, 32, 6),

        # ë°¥ë¥˜
        ("í˜„ë¯¸ë°¥", 210, 4, 44, 2),
        ("ë°±ë¯¸ë°¥", 280, 4, 56, 1),
        ("ë³´ë¦¬ë°¥", 260, 5, 52, 1),
        ("ì˜¤íŠ¸ë°€ì£½", 180, 6, 30, 3),
        ("ì¡ê³¡ë°¥", 240, 6, 48, 2),
        ("ì½©ë‚˜ë¬¼ë¹„ë¹”ë°¥", 480, 18, 70, 8),
        ("ì•¼ì±„ë¹„ë¹”ë°¥", 520, 14, 78, 12),

        # ë©´ë¥˜
        ("ë©”ë°€ì†Œë°”", 350, 18, 50, 4),
        ("ìš°ë™", 420, 12, 70, 4),
        ("ìŒ€êµ­ìˆ˜", 390, 20, 60, 6),
        ("ì¹¼êµ­ìˆ˜", 550, 18, 85, 8),
        ("ì”ì¹˜êµ­ìˆ˜", 430, 14, 60, 10),
        ("í† ë§ˆí† íŒŒìŠ¤íƒ€", 640, 18, 92, 18),
        ("í¬ë¦¼íŒŒìŠ¤íƒ€", 760, 16, 90, 32),
        ("ë¡œì œíŒŒìŠ¤íƒ€", 700, 20, 88, 26),

        # ë¹µ, ê°„ì‹
        ("í†µë°€ë¹µ", 110, 5, 22, 2),
        ("í¬ë£¨ì•„ìƒ", 260, 4, 28, 14),
        ("ë°”ê²ŒíŠ¸", 250, 8, 52, 1),
        ("ì°ê³ êµ¬ë§ˆ", 140, 2, 30, 0.1),
        ("êµ°ê³ êµ¬ë§ˆ", 180, 2, 38, 0.2),
        ("ë‹¨í˜¸ë°•", 70, 1, 16, 0.1),
        ("ê³ ë‹¨ë°± ìš”ê±°íŠ¸", 130, 18, 8, 1),
        ("ê·¸ë¦­ ìš”ê±°íŠ¸", 150, 16, 10, 5),

        # êµ­, ì°Œê°œ
        ("ë¯¸ì†Œëœì¥êµ­", 70, 5, 8, 2),
        ("ìˆœë‘ë¶€ì°Œê°œ", 280, 18, 14, 18),
        ("ê¹€ì¹˜ì°Œê°œ", 240, 18, 12, 14),
        ("ë¶€ëŒ€ì°Œê°œ", 580, 24, 30, 40),
        ("ê°ˆë¹„íƒ•", 350, 26, 8, 24),
        ("ìœ¡ê°œì¥", 400, 30, 10, 26),
        ("ì‚¼ê³„íƒ•", 650, 45, 12, 40),

        # ë°˜ì°¬ë¥˜
        ("ì‹œê¸ˆì¹˜ë‚˜ë¬¼", 40, 3, 2, 1),
        ("ì½©ë‚˜ë¬¼ë¬´ì¹¨", 55, 4, 5, 1),
        ("ì˜¤ì´ë¬´ì¹¨", 45, 1, 8, 1),
        ("ì–´ë¬µë³¶ìŒ", 180, 10, 16, 8),
        ("ì§„ë¯¸ì±„ë³¶ìŒ", 220, 12, 20, 6),
        ("ê³ ë“±ì–´ì¡°ë¦¼", 330, 22, 12, 22),
        ("ê°ìì¡°ë¦¼", 150, 3, 28, 2),
        ("ê³„ë€ë§ì´", 230, 14, 4, 16),
        ("ë²„ì„¯ë³¶ìŒ", 70, 4, 6, 3),
        ("ë¸Œë¡œì½œë¦¬", 55, 4, 6, 1)
    ]

    # ë¶€ì¡±í•œ 700ê°œ ì±„ìš°ê¸°: ì‹¤ì œ ìŒì‹ ì´ë¦„ ìœ„ì£¼ë¡œ ëœë¤ ìƒ˜í”Œ
    additional_foods = [
        ("ì°¸ì¹˜ìƒëŸ¬ë“œ", 180, 22, 6, 8),
        ("ë‹­ê°€ìŠ´ì‚´ìƒëŸ¬ë“œ", 200, 28, 5, 6),
        ("í˜„ë¯¸ë‹­ì£½", 250, 20, 40, 5),
        ("ì•¼ì±„ìŠ¤í”„", 150, 5, 20, 3),
        ("í›ˆì œì—°ì–´ìƒŒë“œìœ„ì¹˜", 300, 25, 28, 12),
        ("ì†Œê³ ê¸°ë³¶ìŒë°¥", 500, 28, 80, 18),
        ("ë‘ë¶€ìŠ¤í…Œì´í¬ìƒëŸ¬ë“œ", 220, 18, 15, 12),
        ("í† ë§ˆí† ë‹¬ê±€ë³¶ìŒ", 120, 8, 6, 7),
        ("ê¹€ë°¥", 350, 12, 68, 8),
        ("ê³„ë€ìƒŒë“œìœ„ì¹˜", 250, 12, 30, 12),
        ("í›ˆì œì—°ì–´ë¡¤", 330, 20, 25, 15),
        ("ì•¼ì±„ë¹„ë¹”ë©´", 400, 12, 70, 10),
        ("ë‹­ê°€ìŠ´ì‚´ìŠ¤í…Œì´í¬", 320, 28, 0, 15),
        ("ì‹œê¸ˆì¹˜ë‘ë¶€ë¬´ì¹¨", 60, 5, 4, 2),
        ("ê°ìì±„ë³¶ìŒ", 100, 2, 18, 3),
    ]

    # 700ê°œë¥¼ ì±„ìš°ê¸° ìœ„í•´ ë°˜ë³µí•´ì„œ ì¶”ê°€
    while len(foods) < 700:
        for f in additional_foods:
            if len(foods) >= 700:
                break
            foods.append(f)

    df = pd.DataFrame(foods, columns=["food", "calories", "protein", "carbs", "fat"])
    return df

FOOD_DB = load_food_database()

# =============================
# USER INPUT
# =============================
st.markdown("## ì‚¬ìš©ì ì •ë³´ ì…ë ¥")
with st.expander("ê¸°ë³¸ ì •ë³´ ì…ë ¥", expanded=True):
    col1, col2 = st.columns(2)
    with col1:
        height = st.number_input("í‚¤ (cm)", min_value=100, max_value=230)
        weight = st.number_input("ëª¸ë¬´ê²Œ (kg)", min_value=30, max_value=200)
        sleep = st.number_input("ìˆ˜ë©´ ì‹œê°„ (ì‹œê°„)", min_value=3, max_value=12)
    with col2:
        age = st.number_input("ë‚˜ì´", min_value=10, max_value=90)
        gender = st.selectbox("ì„±ë³„", ["ë‚¨ì„±", "ì—¬ì„±"])
        water = st.number_input("í•˜ë£¨ ë¬¼ ì„­ì·¨ëŸ‰ (ì”)", min_value=1, max_value=20)

    activity = st.selectbox("í™œë™ëŸ‰", ["ì ìŒ", "ë³´í†µ", "ë§ìŒ"])  
    goal = st.selectbox("ê±´ê°• ëª©í‘œ", ["ì²´ì¤‘ ê°ëŸ‰", "ì²´ì¤‘ ì¦ê°€", "ìœ ì§€", "ì²´ì§€ë°© ê°ì†Œ", "ê·¼ìœ¡ ì¦ê°€"])  
    diet_preference = st.selectbox("ì‹ë‹¨ ì„±í–¥", ["ê· í˜•ì¡íŒ ì‹ë‹¨", "ê³ ë‹¨ë°±", "ì €íƒ„ìˆ˜", "ì €ì§€ë°©", "ë¹„ê±´", "ì±„ì‹ ìœ„ì£¼"])
    preferred_food = st.text_input("ì¢‹ì•„í•˜ëŠ” ìŒì‹")
    mood = st.selectbox("ì˜¤ëŠ˜ ê¸°ë¶„", ["í”¼ê³¤í•¨", "ìƒì¾Œí•¨", "ë³´í†µ", "ìŠ¤íŠ¸ë ˆìŠ¤", "ê¸°ìš´ ì—†ìŒ"])
    allergy = st.text_input("ì•Œë ˆë¥´ê¸°")
    religion = st.text_input("ëª» ë¨¹ëŠ” ìŒì‹(ì¢…êµ ë“±)")

# =============================
# CALCULATE ENERGY
# =============================
def calculate_daily_calories(height, weight, age, gender, activity, goal):
    if gender == "ë‚¨ì„±":
        bmr = 66 + 13.7 * weight + 5 * height - 6.8 * age
    else:
        bmr = 655 + 9.6 * weight + 1.8 * height - 4.7 * age

    factor = {"ì ìŒ": 1.2, "ë³´í†µ": 1.375, "ë§ìŒ": 1.55}[activity]
    tdee = bmr * factor

    if goal == "ì²´ì¤‘ ê°ëŸ‰": tdee -= 300
    if goal == "ì²´ì¤‘ ì¦ê°€": tdee += 300
    if goal == "ê·¼ìœ¡ ì¦ê°€": tdee += 150

    return round(tdee)

# =============================
# CALORIE SPLIT
# =============================
def split_calories(tdee):
    return {
        "breakfast": round(tdee * 0.3),
        "lunch": round(tdee * 0.4),
        "dinner": round(tdee * 0.3)
    }

# =============================
# RECOMMENDER
# =============================
def recommend_meals(target_cal, preferred_food="", allergy="", religion=""):
    df = FOOD_DB.copy()

    if preferred_food:
        df = df[df["food"].str.contains(preferred_food, na=False)]
    if allergy:
        df = df[~df["food"].str.contains(allergy, na=False)]
    if religion:
        df = df[~df["food"].str.contains(religion, na=False)]

    if len(df) == 0:
        df = FOOD_DB.copy()

    return df.sample(5)

# =============================
# RUN BUTTON
# =============================
run = st.button("ì‹ë‹¨ ì„¤ê³„ ì‹œì‘í•˜ê¸°")

if run:
    tdee = calculate_daily_calories(height, weight, age, gender, activity, goal)
    st.success(f"í•˜ë£¨ ê¶Œì¥ ì¹¼ë¡œë¦¬: **{tdee} kcal**")

    split = split_calories(tdee)

    st.markdown("### ğŸ³ ì•„ì¹¨ ì‹ë‹¨")
    st.dataframe(recommend_meals(split["breakfast"], preferred_food, allergy, religion))

    st.markdown("### ğŸš ì ì‹¬ ì‹ë‹¨")
    st.dataframe(recommend_meals(split["lunch"], preferred_food, allergy, religion))

    st.markdown("### ğŸ½ ì €ë… ì‹ë‹¨")
    st.dataframe(recommend_meals(split["dinner"], preferred_food, allergy, religion))

# =============================
# ê³¼í•™ì  ì›ë¦¬ ì„¤ëª…
# =============================
st.markdown("## ğŸ”¬ ê³¼í•™ì  ì›ë¦¬ (í¼ì³ë³´ê¸°)")
with st.expander("ì˜ì–‘í•™ì /ìƒë¦¬í•™ì  ê¸°ë°˜ ì„¤ëª… ë³´ê¸°"):
    st.markdown("""
    ### ğŸ”¥ BMR ê³„ì‚° ì›ë¦¬
    - Harrisâ€“Benedict ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì´ˆëŒ€ì‚¬ëŸ‰ ê³„ì‚°

    ### ğŸ’ª í™œë™ì§€ìˆ˜ ë°˜ì˜
    - í™œë™ ìˆ˜ì¤€ì— ë”°ë¼ 1.2~1.55 ë°° ì¦ê°€

    ### ğŸ¯ ëª©í‘œë³„ ì¹¼ë¡œë¦¬ ì¡°ì •
    - ê°ëŸ‰: -300 kcal
    - ì¦ëŸ‰: +300 kcal
    - ê·¼ì„±ì¥: +150 kcal

    ### ğŸ± ì‹ì‚¬ ì¹¼ë¡œë¦¬ ë°°ë¶„ ê·¼ê±°
    - ì•„ì¹¨ 30%: í˜ˆë‹¹ ì•ˆì • / ì—ë„ˆì§€ ì´ˆê¸° ê³µê¸‰
    - ì ì‹¬ 40%: í•˜ë£¨ í™œë™ëŸ‰ ìµœëŒ€ íƒ€ì´ë°
    - ì €ë… 30%: ìˆ˜ë©´ ì „ ê³¼ë‹¤ ì„­ì·¨ ë°©ì§€

    ### ğŸ§¬ ìŒì‹êµ° 700ê°œ ì‚¬ìš© ì´ìœ 
    - ë‹¤ì–‘ì„± í™•ë³´
    - ê°œì¸ ì·¨í–¥/ì•Œë ˆë¥´ê¸° ëŒ€ì‘
    - ë‹¨ë°±ì§ˆÂ·íƒ„ìˆ˜Â·ì§€ë°© ì¡°í•© ìµœì í™”
    """)
